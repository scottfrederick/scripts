if [ "$#" -lt 3 ]; then
  echo "Usage: $0 ENV_NAME CLUSTER_NAME CLUSTER_MASTER_VM_NAMES"
fi

TS_G_ENV=$1
CLUSTER_NAME=$2
CLUSTER_MASTER_VMS=$3

CLUSTER_MASTER_POOL=${TS_G_ENV}-${CLUSTER_NAME}
CLUSTER_FRONTEND_ADDRESS=${TS_G_ENV}-${CLUSTER_NAME}-cluster-ip
CLUSTER_LOADBALANCER=${TS_G_ENV}-${CLUSTER_NAME}-cluster
DNS_ZONE=${TS_G_ENV}-zone
DNS_NAME=${CLUSTER_NAME}.${TS_G_ENV}.cf-app.com

# gcloud compute addresses create ${CLUSTER_FRONTEND_ADDRESS}
CLUSTER_FRONTEND_IP=$(gcloud compute addresses describe ${CLUSTER_FRONTEND_ADDRESS} --format=json | jq -r .address)

# gcloud compute target-pools create ${CLUSTER_MASTER_POOL}
# gcloud compute target-pools add-instances ${CLUSTER_MASTER_POOL} \
#   --instances=${CLUSTER_MASTER_VMS}
# gcloud compute forwarding-rules create ${CLUSTER_LOADBALANCER} \
#   --address=${CLUSTER_FRONTEND_ADDRESS} \
#   --target-pool=${CLUSTER_MASTER_POOL}

gcloud dns record-sets transaction start \
  --zone=${DNS_ZONE}
gcloud dns record-sets transaction add ${CLUSTER_FRONTEND_IP} \
  --name=${DNS_NAME} \
  --type=A \
  --ttl=5 \
  --zone=${DNS_ZONE}
gcloud dns record-sets transaction execute \
  --zone=${DNS_ZONE}
